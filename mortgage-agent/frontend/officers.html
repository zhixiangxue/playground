<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recommended Loan Officers</title>
    <script src="chatkit.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
        }
        
        body {
            background: #fff;
            color: #000;
            padding: 24px;
            line-height: 1.6;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
        }
        
        .header {
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .header h1 {
            font-size: 20px;
            font-weight: 600;
            color: #000;
            margin-bottom: 6px;
        }
        
        .header .subtitle {
            font-size: 12px;
            color: #666;
        }
        
        .scroll-hint {
            font-size: 11px;
            color: #999;
            margin-top: 4px;
        }
        
        .officers-grid {
            display: flex;
            gap: 12px;
            overflow-x: auto;
            padding-bottom: 12px;
        }
        
        .officers-grid::-webkit-scrollbar {
            height: 6px;
        }
        
        .officers-grid::-webkit-scrollbar-track {
            background: #f5f5f5;
            border-radius: 3px;
        }
        
        .officers-grid::-webkit-scrollbar-thumb {
            background: #000;
            border-radius: 3px;
        }
        
        .officer-card {
            min-width: 320px;
            max-width: 320px;
            height: 280px;
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            padding: 16px;
            transition: all 0.2s;
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
            position: relative;
        }
        
        .officer-card:hover {
            border-color: #000;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }
        
        .officer-header {
            display: flex;
            gap: 12px;
            align-items: start;
            margin-bottom: 12px;
        }
        
        .officer-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: 600;
            color: #fff;
            flex-shrink: 0;
        }
        
        .officer-info {
            flex: 1;
            min-width: 0;
        }
        
        .officer-name {
            font-size: 16px;
            font-weight: 600;
            color: #000;
            margin-bottom: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .officer-title {
            font-size: 13px;
            color: #666;
        }
        
        .officer-rating {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 13px;
            font-weight: 600;
            color: #000;
            white-space: nowrap;
        }
        
        .star {
            color: #000;
            font-size: 16px;
        }
        
        .officer-bio {
            font-size: 12px;
            color: #666;
            line-height: 1.5;
            margin-bottom: 12px;
            padding: 10px;
            background: #f5f5f5;
            border-radius: 6px;
            height: 60px;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
        }
        
        .officer-specialties {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-bottom: 50px;
            flex: 1;
        }
        
        .specialty-tag {
            padding: 4px 10px;
            background: #f5f5f5;
            border-radius: 12px;
            font-size: 11px;
            color: #000;
            font-weight: 500;
        }
        
        .officer-contact {
            position: absolute;
            bottom: 16px;
            left: 16px;
            right: 16px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            padding-top: 12px;
            border-top: 1px solid #f0f0f0;
        }
        
        .contact-btn {
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: all 0.2s;
            text-align: center;
            text-decoration: none;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .contact-btn.primary {
            background: #000;
            color: #fff;
        }
        
        .contact-btn.primary:hover {
            background: #333;
        }
        
        .contact-btn.secondary {
            background: #f5f5f5;
            color: #000;
            border: 1px solid #e0e0e0;
        }
        
        .contact-btn.secondary:hover {
            background: #e0e0e0;
        }
        
        .match-badge {
            display: inline-block;
            padding: 4px 10px;
            background: #000;
            color: #fff;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            margin-left: 8px;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }
        
        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }
        
        .empty-state-title {
            font-size: 18px;
            font-weight: 600;
            color: #000;
            margin-bottom: 8px;
        }
        
        .empty-state-text {
            font-size: 14px;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Recommended Loan Officers</h1>
            <div class="subtitle">Based on your requirements, here are the best matches for you</div>
            <div class="scroll-hint">‚Üê Scroll horizontally to view all ‚Üí</div>
        </div>
        
        <div class="officers-grid" id="officersGrid">
            <!-- Officers will be loaded here -->
        </div>
        
        <div class="empty-state" id="emptyState" style="display: none;">
            <div class="empty-state-icon">üîç</div>
            <div class="empty-state-title">No loan officers found</div>
            <div class="empty-state-text">Please try adjusting your requirements</div>
        </div>
    </div>

    <script>
        console.log('[Officers] ========== Script Starting ==========');
        console.log('[Officers] Current URL:', window.location.href);
        console.log('[Officers] Search params:', window.location.search);
        
        // Initialize ChatKit SDK
        const kit = ChatKit.init({
            pageId: 'officers',
            onReady: function() {
                console.log('[Officers] ‚úì Connected to parent chat interface');
                setTimeout(() => kit.autoResize(), 100);
            }
        });
        console.log('[Officers] ChatKit initialized:', kit);

        // Parse URL parameters
        function getUrlParameter(name) {
            const urlParams = new URLSearchParams(window.location.search);
            const value = urlParams.get(name);
            console.log(`[Officers] Get param "${name}":`, value ? value.substring(0, 100) + '...' : 'null');
            return value;
        }

        // Load officers data
        function loadOfficers() {
            console.log('[Officers] ========== Loading Officers ==========');
            const dataParam = getUrlParameter('data');
            
            if (!dataParam) {
                console.error('[Officers] ‚ùå No data parameter found in URL');
                showEmptyState();
                return;
            }
            
            console.log('[Officers] Data param length:', dataParam.length);
            
            try {
                const decoded = decodeURIComponent(dataParam);
                console.log('[Officers] Decoded data:', decoded.substring(0, 200));
                
                const officers = JSON.parse(decoded);
                console.log('[Officers] ‚úì Parsed officers:', officers);
                console.log('[Officers] Officers count:', officers.length);
                
                if (!officers || officers.length === 0) {
                    console.warn('[Officers] ‚ö†Ô∏è No officers in data');
                    showEmptyState();
                    return;
                }
                
                console.log('[Officers] ‚Üí Rendering officers...');
                renderOfficers(officers);
            } catch (e) {
                console.error('[Officers] ‚ùå Failed to parse data:', e);
                console.error('[Officers] Error stack:', e.stack);
                showEmptyState();
            }
        }

        // Render officers
        function renderOfficers(officers) {
            console.log('[Officers] ========== Rendering ==========');
            const grid = document.getElementById('officersGrid');
            console.log('[Officers] Grid element:', grid);
            
            grid.innerHTML = '';
            
            officers.forEach((officer, index) => {
                console.log(`[Officers] Creating card ${index + 1}:`, officer.name);
                const card = createOfficerCard(officer);
                grid.appendChild(card);
            });
            
            console.log('[Officers] ‚úì All cards rendered');
            
            // Auto resize after rendering
            setTimeout(() => {
                console.log('[Officers] ‚Üí Auto resizing...');
                kit.autoResize();
            }, 100);
        }

        // Create officer card
        function createOfficerCard(officer) {
            const card = document.createElement('div');
            card.className = 'officer-card';
            
            // Generate avatar color based on name
            const colors = ['#4A90E2', '#E24A4A', '#4AE290', '#E2A04A', '#A04AE2', '#E24AA0'];
            const colorIndex = officer.name.charCodeAt(0) % colors.length;
            const avatarColor = colors[colorIndex];
            const initials = officer.name.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();
            
            // Format specialties
            const specialties = officer.specialties.map(s => 
                `<span class="specialty-tag">${formatSpecialty(s)}</span>`
            ).join('');
            
            // Match score badge
            const matchBadge = officer.match_score >= 0.85 ? 
                '<span class="match-badge">BEST MATCH</span>' : '';
            
            card.innerHTML = `
                <div class="officer-header">
                    <div class="officer-avatar" style="background: ${avatarColor};">
                        ${initials}
                    </div>
                    <div class="officer-info">
                        <div class="officer-name">
                            ${officer.name}${matchBadge}
                        </div>
                        <div class="officer-title">${officer.title}</div>
                        <div class="officer-rating">
                            <span class="star">‚òÖ</span>
                            <span>${officer.rating}</span>
                            <span style="color: #999; font-weight: 400;">¬∑ ${officer.years_experience} yrs</span>
                        </div>
                    </div>
                </div>
                
                <div class="officer-bio">${officer.bio}</div>
                
                <div class="officer-specialties">
                    ${specialties}
                </div>
                
                <div class="officer-contact">
                    <a href="mailto:${officer.contact}" class="contact-btn primary">
                        ‚úâÔ∏è Email
                    </a>
                    <a href="tel:${officer.phone}" class="contact-btn secondary">
                        üìû ${officer.phone}
                    </a>
                </div>
            `;
            
            return card;
        }

        // Format specialty text
        function formatSpecialty(specialty) {
            const map = {
                'purchase': 'Purchase',
                'refinance': 'Refinance',
                'investment': 'Investment',
                'second_home': 'Second Home',
                'va_loan': 'VA Loan',
                'jumbo': 'Jumbo Loan',
                'self_employed': 'Self-Employed'
            };
            return map[specialty] || specialty;
        }

        // Show empty state
        function showEmptyState() {
            console.log('[Officers] ========== Showing Empty State ==========');
            document.getElementById('officersGrid').style.display = 'none';
            document.getElementById('emptyState').style.display = 'block';
            setTimeout(() => kit.autoResize(), 100);
        }

        // Load officers on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('[Officers] ========== DOM Content Loaded ==========');
            loadOfficers();
        });
        
        console.log('[Officers] ========== Script Loaded ==========');
    </script>
</body>
</html>
